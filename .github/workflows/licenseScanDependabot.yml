name: License Scan
on: [ pull_request_target ]

jobs:
  license-scan:
    runs-on: ubuntu-latest
    if: github.event.pull_request.user.login == 'dependabot[bot]'
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '14'
      - run: npm ci
      - name: Synopsys Detect
        uses: blackducksoftware/github-action@v2.2
        with:
          version: 7
          blackduck.url: ${{ secrets.BLACKDUCK_URL }}
          blackduck.api.token: ${{ secrets.BLACKDUCK_API_TOKEN }}
          args: >
            --blackduck.trust.cert=true
            --detect.project.tags=WEK
            --detect.policy.check.fail.on.severities="BLOCKER"
            --detect.npm.include.dev.dependencies=false
            --detect.detector.search.exclusion=dist,coverage,node_modules
